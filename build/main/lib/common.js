"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var encode_1 = require("./encode");
var decode_1 = require("./decode");
var C_BACKSLASH = 92;
var entities_1 = require("./entities");
exports.ENTITY = "&(?:#x[a-f0-9]{1,8}|#[0-9]{1,8}|[a-z][a-z0-9]{1,31});";
var TAGNAME = '[A-Za-z][A-Za-z0-9-]*';
var ATTRIBUTENAME = '[a-zA-Z_:][a-zA-Z0-9:._-]*';
var UNQUOTEDVALUE = "[^\"'=<>`\\x00-\\x20]+";
var SINGLEQUOTEDVALUE = "'[^']*'";
var DOUBLEQUOTEDVALUE = '"[^"]*"';
var ATTRIBUTEVALUE = "(?:" + UNQUOTEDVALUE + "|" + SINGLEQUOTEDVALUE + "|" + DOUBLEQUOTEDVALUE + ")";
var ATTRIBUTEVALUESPEC = "(?:" + "\\s*=" + "\\s*" + ATTRIBUTEVALUE + ")";
var ATTRIBUTE = "(?:" + "\\s+" + ATTRIBUTENAME + ATTRIBUTEVALUESPEC + "?)";
exports.OPENTAG = "<" + TAGNAME + ATTRIBUTE + "*" + "\\s*/?>";
exports.CLOSETAG = "</" + TAGNAME + "\\s*[>]";
var HTMLCOMMENT = "<!---->|<!--(?:-?[^>-])(?:-?[^-])*-->";
var PROCESSINGINSTRUCTION = "[<][?].*?[?][>]";
var DECLARATION = "<![A-Z]+" + "\\s+[^>]*>";
var CDATA = "<!\\[CDATA\\[[\\s\\S]*?\\]\\]>";
var HTMLTAG = "(?:" + exports.OPENTAG + "|" + exports.CLOSETAG + "|" + HTMLCOMMENT + "|" + PROCESSINGINSTRUCTION + "|" + DECLARATION + "|" + CDATA + ")";
exports.reHtmlTag = new RegExp('^' + HTMLTAG, 'i');
var reBackslashOrAmp = /[\\&]/;
exports.ESCAPABLE = '[!"#$%&\'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]';
var reEntityOrEscapedChar = new RegExp('\\\\' + exports.ESCAPABLE + '|' + exports.ENTITY, 'gi');
var XMLSPECIAL = '[&<>"]';
var reXmlSpecial = new RegExp(XMLSPECIAL, 'g');
var reXmlSpecialOrEntity = new RegExp(exports.ENTITY + '|' + XMLSPECIAL, 'gi');
var unescapeChar = function (s) {
    if (s.charCodeAt(0) === C_BACKSLASH) {
        return s.charAt(1);
    }
    else {
        return entities_1.decodeHTML(s);
    }
};
// Replace entities and backslash escapes with literal characters.
exports.unescapeString = function (s) {
    if (reBackslashOrAmp.test(s)) {
        return s.replace(reEntityOrEscapedChar, unescapeChar);
    }
    else {
        return s;
    }
};
exports.normalizeURI = function (uri) {
    try {
        return encode_1.encode(decode_1.decode(uri));
    }
    catch (err) {
        return uri;
    }
};
var replaceUnsafeChar = function (s) {
    switch (s) {
        case '&':
            return '&amp;';
        case '<':
            return '&lt;';
        case '>':
            return '&gt;';
        case '"':
            return '&quot;';
        default:
            return s;
    }
};
exports.escapeXml = function (s, preserve_entities) {
    if (reXmlSpecial.test(s)) {
        if (preserve_entities) {
            return s.replace(reXmlSpecialOrEntity, replaceUnsafeChar);
        }
        else {
            return s.replace(reXmlSpecial, replaceUnsafeChar);
        }
    }
    else {
        return s;
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tbW9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9jb21tb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFDQSxtQ0FBa0M7QUFDbEMsbUNBQWtDO0FBRWxDLElBQU0sV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUV2Qix1Q0FBd0M7QUFFM0IsUUFBQSxNQUFNLEdBQUcsdURBQXVELENBQUM7QUFFOUUsSUFBTSxPQUFPLEdBQUcsdUJBQXVCLENBQUM7QUFDeEMsSUFBTSxhQUFhLEdBQUcsNEJBQTRCLENBQUM7QUFDbkQsSUFBTSxhQUFhLEdBQUcsd0JBQXdCLENBQUM7QUFDL0MsSUFBTSxpQkFBaUIsR0FBRyxTQUFTLENBQUM7QUFDcEMsSUFBTSxpQkFBaUIsR0FBRyxTQUFTLENBQUM7QUFDcEMsSUFBTSxjQUFjLEdBQUcsS0FBSyxHQUFHLGFBQWEsR0FBRyxHQUFHLEdBQUcsaUJBQWlCLEdBQUcsR0FBRyxHQUFHLGlCQUFpQixHQUFHLEdBQUcsQ0FBQztBQUN2RyxJQUFNLGtCQUFrQixHQUFHLEtBQUssR0FBRyxPQUFPLEdBQUcsTUFBTSxHQUFHLGNBQWMsR0FBRyxHQUFHLENBQUM7QUFDM0UsSUFBTSxTQUFTLEdBQUcsS0FBSyxHQUFHLE1BQU0sR0FBRyxhQUFhLEdBQUcsa0JBQWtCLEdBQUcsSUFBSSxDQUFDO0FBQ2hFLFFBQUEsT0FBTyxHQUFHLEdBQUcsR0FBRyxPQUFPLEdBQUcsU0FBUyxHQUFHLEdBQUcsR0FBRyxTQUFTLENBQUM7QUFDdEQsUUFBQSxRQUFRLEdBQUcsSUFBSSxHQUFHLE9BQU8sR0FBRyxTQUFTLENBQUM7QUFDbkQsSUFBTSxXQUFXLEdBQUcsdUNBQXVDLENBQUM7QUFDNUQsSUFBTSxxQkFBcUIsR0FBRyxpQkFBaUIsQ0FBQztBQUNoRCxJQUFNLFdBQVcsR0FBRyxVQUFVLEdBQUcsWUFBWSxDQUFDO0FBQzlDLElBQU0sS0FBSyxHQUFHLGdDQUFnQyxDQUFDO0FBQy9DLElBQU0sT0FB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